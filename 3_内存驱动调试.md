查看文档Rockchip_Developer_Guide_SDMMC_SDIO_eMMC_CN.pdf

调设备树参数

由硬件得知该sd由sdmmc0控制：

```
`&sdmmc0 {
	max-frequency = <50000000>;	
	supports-sd;
    no-sd-uhs-sdr104;
    	//启用UHS高速模式时，控制器会尝试切换到1.8V信号电压。
    no-sd-uhs-sdr50;
    no-sd-uhs-ddr50;
	no-sdio;
	no-mmc;
	bus-width = <4>;
	cap-mmc-highspeed;
	cap-sd-highspeed;
	disable-wp;
	//sd-uhs-sdr104;
	// 统一使用开关稳压器供电
	vmmc-supply = <&vcc3v3_sd>;
			//vqmmc-supply = <&vccio_sd>（主电源）
	vqmmc-supply = <&vcc3v3_sd>;		//vccio_sd
			//vmmc-supply = <&vcc3v3_sd>（IO电压）
			//原来由vccio_sd控制电源，会冲突
	post-power-on-delay-ms = <200>;
	rockchip,default-sample-phase = <90>;
	pinctrl-names = "default";
	pinctrl-0 = <&sdmmc0_bus4 &sdmmc0_clk &sdmmc0_cmd &sdmmc0_det>;
	status = "okay";
};`
```

```
			vcc3v3_sd: SWITCH_REG2 {
				compatible = "regulator-fixed";
				//gpio = <&gpio7 11 GPIO_ACTIVE_LOW>;
				pinctrl-names = "default";
				pinctrl-0 = <&sdmmc0_pwren>;
				regulator-always-on;
				regulator-boot-on;
				regulator-name = "vcc3v3_sd";
				regulator-min-microvolt = <3300000>;
				regulator-max-microvolt = <3300000>;
				startup-delay-us = <200000>;
				regulator-state-mem {
					regulator-off-in-suspend;
				};
			};
```

原代码检测到sd卡初始化失败，-123和-110错误

​	`	-123`（ENOMEDIUM）

​	`-110`（ETIMEDOUT）

软件排查：确认内核已启用 SD 卡相关驱动

```
dmesg | grep mmc
zcat /proc/config.gz | grep -E "MMC|SDHCI|DWMMC"
	CONFIG_MMC=y
	CONFIG_MMC_DW=y
	CONFIG_MMC_DW_ROCKCHIP=y
	CONFIG_MMC_SDHCI=y
	
cat /sys/kernel/debug/mmc1/ios
	clock:		0 Hz
	vdd:		0 (invalid)
	bus mode:	2 (push-pull)
	chip select:	0 (don't care)
	power mode:	0 (off)
    bus width:	0 (1 bits)
    timing spec:	0 (legacy)
    signal voltage:	1 (1.80 V)
    driver type:	0 (driver type B)
    //检查引脚复用，电压切换为1.8v
```



成功后测试

```
// 应显示类似：/dev/mmcblk1  /dev/mmcblk1p1
ls /dev/mmcblk1*  

# 正常输出示例：
# /dev/mmcblk1p1 on /mnt type vfat (rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=utf8)
mount | grep mmcblk1


//写入测试（1GB文件）
dd if=/dev/zero of=/mnt/test.bin bs=1M count=1024 conv=fsync

# 清除缓存后测试真实读取速度
sync && echo 3 > /proc/sys/vm/drop_caches
dd if=/mnt/test.bin of=/dev/null bs=1M count=1024
```

